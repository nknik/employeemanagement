<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css"
    />

    <title>Sign Up</title>
  </head>
  <body>
    <div class="container">
      <div class="container">
        <h1 >                                 Sign Up</h1>
        {% for message in messages %}
        <h3 style="color: red;"> {{message}}  </h3>
        {% endfor %}
        <form method="POST" class="col s6" id="myForm" novalidate>
          {% csrf_token %}

          <div class="row">
            <div class="input-field col s6">
              <label for="firstName">First Name</label>
              <input
                type="text"
                name="FirstName"
                id="firstName"
                onfocusout="validateFirstName()"
              />
              <span class="helper-text"></span>
            </div>
            <div class="input-field col s6">
              <label for="lastName">Last Name</label>
              <input
                type="text"
                name="LastName"
                id="lastName"
                onfocusout="validateLastName()"
              />
              <span class="helper-text"></span>
            </div>
          </div>
          <div class="row">
            <div class="input-field col s12">
              <label for="address">Address</label>
              <input
                type="text"
                name="address"
                id="address"
                onfocusout="validateAddress()"
              />
              <span class="helper-text"></span>
            </div>
          </div>
          <div class="row">
            <div class="input-field col s6">
              <label for="password">Date Of Birth</label>
              <input
                type="date"
                name="dob"
                id="dob"
                onfocusout="validateDob()"
              />
              <span class="helper-text"></span>
            </div>
            <div class="input-field col s6">
              <label for="confirmPassword">Company Name</label>
              <input
                type="text"
                name="company"
                id="company"
                onfocusout="validateCompany()"
              />
              <span class="helper-text"></span>
            </div>
          </div>
          <div class="row">
            <div class="input-field col s6">
              <label for="password">Password</label>
              <input
                type="password"
                name="PasswordA"
                id="password"
                onfocusout="validatePassword()"
              />
              <span class="helper-text"></span>
            </div>
            <div class="input-field col s6">
              <label for="confirmPassword">Confirm Password</label>
              <input
                type="password"
                name="PasswordB"
                id="confirmPassword"
                onfocusout="validateConfirmPassword()"
              />
              <span class="helper-text"></span>
            </div>
          </div>
          <div class="row">
            <div class="input-field col s12">
              <label for="email">Email</label>
              <input
                type="email"
                name="Email"
                id="email"
                onfocusout="validateEmail()"
              />
              <span class="helper-text"></span>
            </div>
          </div>
          <button href="register" class="btn waves-effect waves-light" type="submit">
            SignUp
          </button>
        </form>
        <h5><a href="login">already have account,login here?</a></h5>
      </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script>
      const firstName = document.getElementById('firstName');
      const address = document.getElementById('address');
      const dob = document.getElementById('dob');
      const comapny = document.getElementById('company');
const lastName = document.getElementById('lastName');
const password = document.getElementById('password');
const confirmPassword = document.getElementById('confirmPassword');
const email = document.getElementById('email');
// Form
const form = document.getElementById('myForm');
// Validation colors
const green = '#4CAF50';
const red = '#F44336';

// Handle form
form.addEventListener('submitt', function(event) {
  // Prevent default behaviour
  event.preventDefault();
  if (
    validateFirstName() &&
    validateLastName() &&
    validatePassword() &&
    validateConfirmPassword() &&
    validateEmail() && validateAddress()
    && validateDob() && validateCompany()
  ) {
    const name = firstName.value;
    const container = document.querySelector('div.container');
    const loader = document.createElement('div');
    loader.className = 'progress';
    const loadingBar = document.createElement('div');
    loadingBar.className = 'indeterminate';
    loader.appendChild(loadingBar);
    container.appendChild(loader);
    setTimeout(function() {
      const loaderDiv = document.querySelector('div.progress');
      const panel = document.createElement('div');
      panel.className = 'card-panel green';
      const text = document.createElement('span');
      text.className = 'white-text';
      text.appendChild(
        document.createTextNode(
          `Sign up successful, welcome to EMS, ${name}`
        )
      );
      panel.appendChild(text);
      container.replaceChild(panel, loaderDiv);
    }, 1000);
  }
});

// Validators
function validateFirstName() {
  // check if is empty
  if (checkIfEmpty(firstName)) return;
  // is if it has only letters
  if (!checkIfOnlyLetters(firstName)) return;
  return true;
}
function validateLastName() {
  // check if is empty
  if (checkIfEmpty(lastName)) return;
  // is if it has only letters
  if (!checkIfOnlyLetters(lastName)) return;
  return true;
}
function validateAddress() {
  // check if is empty
  if (checkIfEmpty(address)) return;
  // is if it has only letters
  return true;
}
function validateDob() {
  // check if is empty
  if (checkIfEmpty(dob)) return;
  // is if it has only letters
  return true;
}
function validateCompany() {
  // check if is empty
  if (checkIfEmpty(company)) return;
  // is if it has only letters
  return true;
}
function validatePassword() {
  // Empty check
  if (checkIfEmpty(password)) return;
  // Must of in certain length
  if (!meetLength(password, 4, 100)) return;
  // check password against our character set
  // 1- a
  // 2- a 1
  // 3- A a 1
  // 4- A a 1 @
     if (!containsCharacters(password, 4)) return;
  return true;
}
function validateConfirmPassword() {
  if (password.className !== 'valid') {
    setInvalid(confirmPassword, 'Password must be valid');
    return;
  }
  // If they match
  if (password.value !== confirmPassword.value) {
    setInvalid(confirmPassword, 'Passwords must match');
    return;
  } else {
    setValid(confirmPassword);
  }
  return true;
}
function validateEmail() {
  if (checkIfEmpty(email)) return;
  if (!containsCharacters(email, 5)) return;
  return true;
}
// Utility functions
function checkIfEmpty(field) {
  if (isEmpty(field.value.trim())) {
    // set field invalid
    setInvalid(field, `${field.name} must not be empty`);
    return true;
  } else {
    // set field valid
    setValid(field);
    return false;
  }
}
function isEmpty(value) {
  if (value === '') return true;
  return false;
}
function setInvalid(field, message) {
  field.className = 'invalid';
  field.nextElementSibling.innerHTML = message;
  field.nextElementSibling.style.color = red;
}
function setValid(field) {
  field.className = 'valid';
  field.nextElementSibling.innerHTML = '';
  //field.nextElementSibling.style.color = green;
}
function checkIfOnlyLetters(field) {
  if (/^[a-zA-Z ]+$/.test(field.value)) {
    setValid(field);
    return true;
  } else {
    setInvalid(field, `${field.name} must contain only letters`);
    return false;
  }
}
function meetLength(field, minLength, maxLength) {
  if (field.value.length >= minLength && field.value.length < maxLength) {
    setValid(field);
    return true;
  } else if (field.value.length < minLength) {
    setInvalid(
      field,
      `${field.name} must be at least ${minLength} characters long`
    );
    return false;
  } else {
    setInvalid(
      field,
      `${field.name} must be shorter than ${maxLength} characters`
    );
    return false;
  }
}
function containsCharacters(field, code) {
  let regEx;
  switch (code) {
    case 1:
      // letters
      regEx = /(?=.*[a-zA-Z])/;
      return matchWithRegEx(regEx, field, 'Must contain at least one letter');
    case 2:
      // letter and numbers
      regEx = /(?=.*\d)(?=.*[a-zA-Z])/;
      return matchWithRegEx(
        regEx,
        field,
        'Must contain at least one letter and one number'
      );
    case 3:
      // uppercase, lowercase and number
      regEx = /(?=.*\d)(?=.*[a-z])(?=.*[A-Z])/;
      return matchWithRegEx(
        regEx,
        field,
        'Must contain at least one uppercase, one lowercase letter and one number'
      );
    case 4:
      // uppercase, lowercase, number and special char
      regEx = /(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*\W)/;
      return matchWithRegEx(
        regEx,
        field,
        'Must contain at least one uppercase, one lowercase letter, one number and one special character'
      );
    case 5:
      // Email pattern
      regEx = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
      return matchWithRegEx(regEx, field, 'Must be a valid email address');
    default:
      return false;
  }
}
function matchWithRegEx(regEx, field, message) {
  if (field.value.match(regEx)) {
    setValid(field);
    return true;
  } else {
    setInvalid(field, message);
    return false;
  }
}

    </script>
  </body>
</html>
